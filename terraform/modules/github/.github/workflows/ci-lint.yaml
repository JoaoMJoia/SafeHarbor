---
# This workflow performs linting and validation checks on Terraform, YAML, JSON, Shell, and Bash files.
# It uses Super Linter to ensure code quality and formatting consistency across the repository.
#
# How it works:
# 1. Triggers on pushes to 'main' branch and all pull requests
# 2. Only runs the lint job on pull requests (not on direct pushes to main)
# 3. Uses Super Linter with custom configuration from '.github/linters/'
# 4. Validates and formats:
#    - YAML files (with custom config)
#    - JSON files
#    - Terraform files (formatting and tflint)
#    - Shell scripts (shfmt formatting)
#    - Bash scripts
#    - Security checks using Checkov
# 5. Automatically fixes formatting issues where possible (Terraform fmt)
#
# Usage:
#   - Automatically runs on all pull requests
#   - No manual intervention needed
#   - Linting errors will appear as status checks on the PR
#   - Some formatting issues are automatically fixed
name: CI - Lint

on:
  push:
    branches:
      - "main"
  pull_request:

permissions:
  contents: read
  packages: read
  statuses: write

jobs:
  terraform-lint:
    if: github.event_name == 'pull_request'
    name: Terraform Lint
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: List actionlint.yml
        run: |
          ls -lhtar .github/linters/.yaml-lint.yml
      - name: Super Linter Run
        uses: super-linter/super-linter/slim@v8
        env:
          VALIDATE_ALL_CODEBASE: false
          LINTER_RULES_PATH: .github/linters
          LOG_LEVEL: INFO
          GITHUB_TOKEN: ${{ github.token }}
          # YAML
          VALIDATE_YAML: true
          YAML_CONFIG_FILE: .yaml-lint.yml
          YAML_ERROR_ON_WARNING: false
          # JSON
          VALIDATE_JSON: true
          FIX_JSON: false
          # Terraform format
          VALIDATE_TERRAFORM_FMT: true
          FIX_TERRAFORM_FMT: true
          # Terraform lint
          VALIDATE_TERRAFORM_TFLINT: true
          # Shell
          VALIDATE_SHELL_SHFMT: true
          # Bash
          VALIDATE_BASH: true
          # Checkov
          VALIDATE_CHECKOV: true
          CHECKOV_FILE_NAME: .checkov.yaml
...